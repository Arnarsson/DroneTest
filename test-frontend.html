<!DOCTYPE html>
<html>
<head>
    <title>DroneMap API Test</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
        pre { background: #f4f4f4; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>DroneMap API Debug Test</h1>
    <div id="status">Testing...</div>
    <pre id="output"></pre>

    <script>
        const output = document.getElementById('output');
        const status = document.getElementById('status');

        function log(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = msg;
            output.appendChild(div);
            console.log(msg);
        }

        async function testAPI() {
            try {
                log('=== Testing API Endpoint ===');
                log('URL: https://www.dronemap.cc/api/incidents?min_evidence=1&country=all&status=all&limit=5');

                const response = await fetch('https://www.dronemap.cc/api/incidents?min_evidence=1&country=all&status=all&limit=5');

                log(`Status: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                log(`Headers:`);
                for (let [key, value] of response.headers.entries()) {
                    log(`  ${key}: ${value}`);
                }

                if (response.ok) {
                    const data = await response.json();
                    log(`\nReceived ${data.length} incidents`, 'success');
                    log(`\nFirst incident:`);
                    log(JSON.stringify(data[0], null, 2));
                    status.textContent = `✅ SUCCESS - Got ${data.length} incidents`;
                    status.className = 'success';
                } else {
                    const text = await response.text();
                    log(`\nError response: ${text}`, 'error');
                    status.textContent = `❌ FAILED - ${response.status}`;
                    status.className = 'error';
                }
            } catch (error) {
                log(`\nException: ${error.message}`, 'error');
                log(`Stack: ${error.stack}`, 'error');
                status.textContent = `❌ EXCEPTION - ${error.message}`;
                status.className = 'error';
            }
        }

        testAPI();
    </script>
</body>
</html>